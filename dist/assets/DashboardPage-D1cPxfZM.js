import{h as oe,u as J,j as e,r as s,l as be,m as Le,n as ie,o as Ee,p as De,D as re,d as ee,q as le,c as Re,e as Se,t as Fe,v as ve,w as Ie,x as Ue,y as ze,z as Ae,E as He}from"./index-CNPq4IXK.js";import{B as V}from"./Button-Clu2HRRO.js";import{C as te}from"./Card-XH0dO2Dj.js";const ke=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),$e=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),Pe=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),Be=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),Ve=({className:r="w-5 h-5"})=>e.jsxs("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),We=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),Ke=({className:r="w-5 h-5"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),Oe=({className:r="w-6 h-6"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),_e=({className:r="w-6 h-6"})=>e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),qe=({activeSection:r,onSectionChange:f,isOpen:l,onToggle:j})=>{var b;const{user:m,logout:a}=oe(),{t:x}=J(),h=[{id:"posts",label:x("dashboard.tabs.posts"),icon:ke},{id:"messages",label:x("dashboard.tabs.messages"),icon:$e},{id:"subscriptions",label:x("dashboard.tabs.subscriptions")||"Subscriptions",icon:We},{id:"users",label:x("dashboard.tabs.users"),icon:Pe},{id:"team",label:x("dashboard.tabs.team"),icon:Be},{id:"settings",label:x("dashboard.tabs.settings"),icon:Ve}],u=[{id:"posts",label:x("dashboard.tabs.posts"),icon:ke}],C=(m==null?void 0:m.role)==="admin"||(m==null?void 0:m.role)==="Super admin"?h:u,d=p=>{f(p),window.innerWidth<1024&&j()};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,className:"lg:hidden fixed top-20 left-4 z-50 bg-smart-blue text-white p-2 rounded-lg shadow-lg","aria-label":"Toggle menu",children:l?e.jsx(_e,{}):e.jsx(Oe,{})}),l&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:j}),e.jsxs("aside",{className:`
          fixed lg:sticky top-0 left-0 h-screen bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700
          w-64 z-40 transform transition-transform duration-300 ease-in-out flex flex-col
          ${l?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        `,children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-smart-blue text-white flex items-center justify-center font-bold text-lg",children:(b=m==null?void 0:m.email)==null?void 0:b.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:m==null?void 0:m.email}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:m==null?void 0:m.role})]})]})}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("ul",{className:"space-y-2",children:C.map(p=>{const y=p.icon,i=r===p.id;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>d(p.id),className:`
                      w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200
                      ${i?"bg-smart-blue text-white shadow-md":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}
                    `,children:[e.jsx(y,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:p.label})]})},p.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:x("nav.logout")})]})})]})]})},we=({value:r,onChange:f,placeholder:l="Enter content...",className:j="",dir:m="ltr"})=>{const a=s.useRef(null),x=s.useRef(!1);s.useEffect(()=>{a.current&&!x.current&&a.current.innerHTML!==r&&(a.current.innerHTML=r||""),x.current=!1},[r]);const h=s.useCallback(()=>{if(a.current){x.current=!0;const b=a.current.innerHTML,p=b==="<br>"||b==="<div><br></div>"||b.trim()==="";f(p?"":b)}},[f]),u=s.useCallback((b,p)=>{var y;document.execCommand(b,!1,p),(y=a.current)==null||y.focus(),h()},[h]),C=s.useCallback(b=>{b.key==="Tab"&&(b.preventDefault(),u("insertHTML","&nbsp;&nbsp;&nbsp;&nbsp;"))},[u]),d=({onClick:b,title:p,children:y,active:i})=>e.jsx("button",{type:"button",onClick:b,title:p,className:`p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors ${i?"bg-gray-200 dark:bg-gray-600":""}`,children:y});return e.jsxs("div",{className:`rich-text-editor border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden ${j}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2 bg-gray-50 dark:bg-gray-700 border-b border-gray-300 dark:border-gray-600",children:[e.jsx(d,{onClick:()=>u("bold"),title:"Bold",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"})})}),e.jsx(d,{onClick:()=>u("italic"),title:"Italic",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"})})}),e.jsx(d,{onClick:()=>u("underline"),title:"Underline",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"})})}),e.jsx(d,{onClick:()=>u("strikeThrough"),title:"Strikethrough",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 19h4v-3h-4v3zM5 4v3h5v3h4V7h5V4H5zM3 14h18v-2H3v2z"})})}),e.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsxs("select",{onChange:b=>u("formatBlock",b.target.value),className:"px-2 py-1 text-sm bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded",defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Heading"}),e.jsx("option",{value:"p",children:"Normal"}),e.jsx("option",{value:"h1",children:"Heading 1"}),e.jsx("option",{value:"h2",children:"Heading 2"}),e.jsx("option",{value:"h3",children:"Heading 3"})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx(d,{onClick:()=>u("insertUnorderedList"),title:"Bullet List",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),e.jsx(d,{onClick:()=>u("insertOrderedList"),title:"Numbered List",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),e.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx(d,{onClick:()=>{const b=prompt("Enter URL:");b&&u("createLink",b)},title:"Insert Link",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})})}),e.jsx(d,{onClick:()=>u("removeFormat"),title:"Clear Formatting",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21 18 19.73 3.55 5.27 3.27 5zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5H6z"})})})]}),e.jsx("div",{ref:a,contentEditable:!0,dir:m,onInput:h,onKeyDown:C,className:"min-h-[200px] p-4 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none prose prose-sm max-w-none dark:prose-invert",style:{textAlign:m==="rtl"?"right":"left"},"data-placeholder":l,suppressContentEditableWarning:!0}),e.jsx("style",{children:`
        .rich-text-editor [contenteditable]:empty:before {
          content: attr(data-placeholder);
          color: #9ca3af;
          pointer-events: none;
        }
        .rich-text-editor [contenteditable] h1 { font-size: 2em; font-weight: bold; margin: 0.5em 0; }
        .rich-text-editor [contenteditable] h2 { font-size: 1.5em; font-weight: bold; margin: 0.5em 0; }
        .rich-text-editor [contenteditable] h3 { font-size: 1.17em; font-weight: bold; margin: 0.5em 0; }
        .rich-text-editor [contenteditable] p { margin: 0.5em 0; }
        .rich-text-editor [contenteditable] ul, .rich-text-editor [contenteditable] ol { margin: 0.5em 0; padding-left: 1.5em; }
        .rich-text-editor [contenteditable] li { margin: 0.25em 0; }
        .rich-text-editor [contenteditable] a { color: #3b82f6; text-decoration: underline; }
      `})]})},pe=()=>{const[r,f]=s.useState(!1);return{translate:s.useCallback(async(j,m)=>{if(!j.trim())return"";f(!0);try{const a=await be("/translate",{method:"POST",body:JSON.stringify({text:j,context:m})});if(!a.ok)throw new Error("Translation request failed");return(await a.json()).translated_text||""}catch(a){return console.error("Translation Hook Error:",a),""}finally{f(!1)}},[]),isTranslating:r}},Ce=({children:r,color:f="gray",className:l})=>{const j={green:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j[f]} ${l}`,children:r})},ue=({isOpen:r,onClose:f,children:l,title:j})=>{const m=s.useRef(null),a=s.useRef(null);return s.useEffect(()=>{var h;if(!r)return;const x=u=>{var C;if(u.key==="Escape")f();else if(u.key==="Tab"){const d=(C=m.current)==null?void 0:C.querySelectorAll("a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled])");if(!d||d.length===0)return;const b=d[0],p=d[d.length-1];u.shiftKey?document.activeElement===b&&(p.focus(),u.preventDefault()):document.activeElement===p&&(b.focus(),u.preventDefault())}};return document.addEventListener("keydown",x),(h=a.current)==null||h.focus(),()=>{document.removeEventListener("keydown",x)}},[r,f]),r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 z-50 flex justify-center items-center p-4",onClick:f,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{ref:m,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex justify-between items-center z-10",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:j}),e.jsx("button",{ref:a,onClick:f,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors","aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6",children:l})]})}):null},ye=({isOpen:r,onClose:f,onConfirm:l,title:j,message:m})=>{const{t:a}=J();return e.jsx(ue,{isOpen:r,onClose:f,title:j,children:e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-6",children:m}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(V,{variant:"secondary",onClick:f,children:a("dashboard.confirmDelete.cancel")}),e.jsx("button",{onClick:l,className:"px-8 py-3 rounded-lg font-bold text-sm uppercase tracking-wider transition-all duration-300 transform focus:outline-none focus:ring-4 focus:ring-opacity-50 bg-red-600 text-white shadow-lg hover:shadow-xl focus:ring-red-300 hover:-translate-y-0.5",children:a("dashboard.confirmDelete.confirm")})]})]})})},Ge=({value:r,onChange:f,onClose:l})=>{const[j,m]=s.useState([]),[a,x]=s.useState(!0),[h,u]=s.useState(!1),[C,d]=s.useState(0),[b,p]=s.useState(null),[y,i]=s.useState(r),[E,R]=s.useState(!1),N=s.useRef(null),U=s.useRef(!0);s.useEffect(()=>(U.current=!0,()=>{U.current=!1}),[]);const M=s.useCallback(async()=>{try{x(!0),p(null);const t=await Le("image");U.current&&m(t.data||[])}catch(t){console.error("Failed to load media:",t),U.current&&p("Failed to load media library")}finally{U.current&&x(!1)}},[]);s.useEffect(()=>{M()},[M]);const T=async t=>{if(!t||t.length===0)return;const g=t[0];if(!g.type.startsWith("image/")){p("Please select an image file");return}if(g.size>10*1024*1024){p("File size must be less than 10MB");return}try{u(!0),d(0),p(null);const S=setInterval(()=>{d(k=>Math.min(k+10,90))},100),v=await Ee(g);clearInterval(S),U.current&&v.media&&(d(100),m(k=>[v.media,...k]),i(v.media.url))}catch(S){console.error("Upload failed:",S),U.current&&p(S.message||"Upload failed")}finally{U.current&&(u(!1),d(0))}},F=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?R(!0):t.type==="dragleave"&&R(!1)},o=t=>{t.preventDefault(),t.stopPropagation(),R(!1),T(t.dataTransfer.files)},c=t=>{i(t.url)},L=()=>{y&&f(y),l()},H=()=>{l()},z=async(t,g,S)=>{if(S.stopPropagation(),!!window.confirm("Are you sure you want to delete this image?"))try{await De(t),U.current&&(m(v=>v.filter(k=>k.id!==t)),y===g&&i(""))}catch(v){console.error("Delete failed:",v),U.current&&p("Failed to delete image")}},X=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB";return s.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t=>{t.target===t.currentTarget&&H()},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Media Library"}),e.jsx("button",{type:"button",onClick:H,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 text-2xl leading-none",children:"Ã—"})]}),e.jsx("div",{className:`m-4 p-6 border-2 border-dashed rounded-lg transition-colors ${E?"border-smart-blue bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400"}`,onDragEnter:F,onDragLeave:F,onDragOver:F,onDrop:o,children:e.jsxs("div",{className:"text-center",children:[h?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{className:"w-8 h-8 mx-auto text-smart-blue"}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:e.jsx("div",{className:"h-full bg-smart-blue transition-all duration-300",style:{width:`${C}%`}})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:["Drag and drop an image here, or"," ",e.jsx("button",{type:"button",onClick:()=>{var t;return(t=N.current)==null?void 0:t.click()},className:"text-smart-blue hover:underline font-medium",children:"browse"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Supports: JPG, PNG, GIF, WebP (max 10MB)"})]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:t=>{T(t.target.files),t.target.value=""},className:"hidden"})]})}),b&&e.jsx("div",{className:"mx-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:b})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-[200px]",children:a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"w-8 h-8 text-smart-blue"})}):j.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No images uploaded yet"}),e.jsx("p",{className:"text-sm",children:"Upload your first image above"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:j.map(t=>e.jsxs("div",{onClick:()=>c(t),className:`relative group cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${y===t.url?"border-smart-blue ring-2 ring-smart-blue ring-opacity-50":"border-transparent hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("div",{className:"aspect-square bg-gray-100 dark:bg-gray-700",children:e.jsx("img",{src:t.url,alt:t.alt_text||t.original_name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:g=>z(t.id,t.url,g),className:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-all",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),y===t.url&&e.jsx("div",{className:"absolute top-2 right-2 bg-smart-blue text-white rounded-full p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("p",{className:"text-white text-xs truncate",children:t.original_name}),e.jsx("p",{className:"text-gray-300 text-xs",children:X(t.size)})]})]},t.id))})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[j.length," ",j.length===1?"image":"images"," in library"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:H,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:L,disabled:!y,className:"px-4 py-2 text-sm font-medium text-white bg-smart-blue rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select Image"})]})]})]})})},Ne=()=>{const{posts:r,deletePost:f,updatePost:l,addPost:j}=s.useContext(re),{user:m}=oe(),{t:a,language:x}=J(),{translate:h}=pe(),[u,C]=s.useState("list"),[d,b]=s.useState(null),[p,y]=s.useState(""),[i,E]=s.useState("all"),[R,N]=s.useState(null),U={title:{ar:"",en:""},excerpt:{ar:"",en:""},content:{ar:"",en:""},imageUrl:"",status:"draft"},[M,T]=s.useState(U),[F,o]=s.useState(!1),[c,L]=s.useState({}),[H,z]=s.useState({title:!1,excerpt:!1,content:!1}),[X,t]=s.useState(!1),[g,S]=s.useState(()=>localStorage.getItem("autoTranslateEnabled")!=="false"),v=s.useRef(null),k=s.useRef(null);s.useEffect(()=>{u==="add"&&(T(d?{title:d.title,excerpt:d.excerpt,content:d.content,imageUrl:d.imageUrl,status:d.status}:U),L({}))},[u,d]),s.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]);const W=s.useMemo(()=>{let n=r;return m&&m.role==="employee"&&(n=r.filter(w=>w.author===m.email)),n.filter(w=>(x==="ar"?w.title.ar:w.title.en).toLowerCase().includes(p.toLowerCase())).filter(w=>i==="all"?!0:w.status===i)},[r,p,i,x,m]),O=n=>{b(n),C("add")},D=()=>{b(null),C("add")},$=n=>{N(n)},_=async()=>{R&&(await f(R.id),N(null))},q=async n=>{const w=n.status==="published"?"draft":"published";await l({...n,status:w})},G=()=>{const n={title:{},excerpt:{},content:{}};let w=!0;return M.title.en.trim()||(n.title.en=a("contact.validation.fieldRequired"),w=!1),M.title.ar.trim()||(n.title.ar=a("contact.validation.fieldRequired"),w=!1),M.excerpt.en.trim()||(n.excerpt.en=a("contact.validation.fieldRequired"),w=!1),M.excerpt.ar.trim()||(n.excerpt.ar=a("contact.validation.fieldRequired"),w=!1),M.content.en.trim()||(n.content.en=a("contact.validation.fieldRequired"),w=!1),M.content.ar.trim()||(n.content.ar=a("contact.validation.fieldRequired"),w=!1),M.imageUrl.trim()||(n.imageUrl=a("contact.validation.fieldRequired"),w=!1),L(n),w},Q=n=>{const{name:w,value:A}=n.target;if(k.current=w,w.includes(".")){const[B,Z]=w.split(".");T(K=>({...K,[B]:{...K[B],[Z]:A}}))}else T(B=>({...B,[w]:A}));if(!g||(v.current&&clearTimeout(v.current),!w.includes(".")))return;const[I,P]=w.split(".");if(!A.trim()){z(B=>({...B,[I]:!1}));return}z(B=>({...B,[I]:!0})),v.current=window.setTimeout(async()=>{if(k.current!==w){z(Y=>({...Y,[I]:!1}));return}const B=P==="ar"?"en":"ar",Z=`a blog post ${I}`,K=await h(A,Z);K&&k.current===w&&T(Y=>{const xe=A;return Y[I][P]===xe?{...Y,[I]:{...Y[I],[B]:K}}:Y}),z(Y=>({...Y,[I]:!1}))},800)},ne=(n,w,A)=>{const I=`${n}.${w}`;if(k.current=I,T(P=>({...P,[n]:{...P[n],[w]:A}})),!!g){if(v.current&&clearTimeout(v.current),!A.trim()||A==="<p><br></p>"){z(P=>({...P,[n]:!1}));return}z(P=>({...P,[n]:!0})),v.current=window.setTimeout(async()=>{if(k.current!==I){z(K=>({...K,[n]:!1}));return}const P=w==="ar"?"en":"ar",B=`a blog post ${n} in HTML format. Keep the HTML tags (like <p>, <strong>, <ul>, etc.) exactly as they are and only translate the text content inside them.`,Z=await h(A,B);Z&&k.current===I&&T(K=>K[n][w]===A?{...K,[n]:{...K[n],[P]:Z}}:K),z(K=>({...K,[n]:!1}))},1e3)}},de=async n=>{const w=M[n].en.trim(),A=M[n].ar.trim();if(!(!w&&!A)){z(I=>({...I,[n]:!0}));try{const I=`a blog post ${n}`;if(w&&!A){const P=await h(w,I);P&&T(B=>({...B,[n]:{...B[n],ar:P}}))}else if(A&&!w){const P=await h(A,I);P&&T(B=>({...B,[n]:{...B[n],en:P}}))}else if(w){const P=await h(w,I);P&&T(B=>({...B,[n]:{...B[n],ar:P}}))}}catch(I){console.error("Translation failed:",I)}finally{z(I=>({...I,[n]:!1}))}}},fe=async(n,w=!1)=>{if(n.preventDefault(),!G()||!m)return;const A={...M,status:w?"draft":M.status};o(!0);try{d?await l({...d,...A}):await j(A,m.email),T(U),b(null),C("list")}catch(I){console.error("Failed to save post",I),alert("Could not save post. Please try again.")}finally{o(!1)}},je=()=>{T(U),b(null),C("list")},ce=n=>`w-full px-3 py-2 border rounded-lg focus:outline-none transition duration-150 ease-in-out bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${n?"border-red-400 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:ring-2 focus:ring-blue-200 focus:border-smart-blue"}`,he=(n,w,A="input")=>{var K,Y,xe,me;const I=A==="input"?"input":"textarea",P=A==="textarea"?n==="excerpt"?3:6:void 0,B=M[n].en.trim()||M[n].ar.trim(),Z=n==="content";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[w,H[n]&&e.jsx(ie,{className:"inline-block ml-2 h-4 w-4 text-smart-blue"})]}),!g&&B&&e.jsxs("button",{type:"button",onClick:()=>de(n),disabled:H[n],className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-smart-blue hover:text-smart-blue-dark bg-blue-50 dark:bg-blue-900/30 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors disabled:opacity-50",children:[e.jsx(le,{className:"h-3 w-3"}),H[n]?"Translating...":"Translate"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"English"}),e.jsx(le,{className:"h-3 w-3 text-gray-400"})]}),Z?e.jsx(we,{value:M[n].en,onChange:ge=>ne(n,"en",ge),placeholder:`Enter ${n} in English...`,dir:"ltr"}):e.jsx(I,{name:`${n}.en`,value:M[n].en,onChange:Q,rows:P,className:ce((K=c[n])==null?void 0:K.en),placeholder:`Enter ${n} in English...`}),((Y=c[n])==null?void 0:Y.en)&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:c[n].en})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}),e.jsx(le,{className:"h-3 w-3 text-gray-400"})]}),Z?e.jsx(we,{value:M[n].ar,onChange:ge=>ne(n,"ar",ge),placeholder:`Ø£Ø¯Ø®Ù„ ${n==="title"?"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†":n==="excerpt"?"Ø§Ù„Ù…Ù‚ØªØ·Ù":"Ø§Ù„Ù…Ø­ØªÙˆÙ‰"} Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...`,dir:"rtl"}):e.jsx(I,{name:`${n}.ar`,value:M[n].ar,onChange:Q,dir:"rtl",rows:P,className:ce((xe=c[n])==null?void 0:xe.ar),placeholder:`Ø£Ø¯Ø®Ù„ ${n==="title"?"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†":n==="excerpt"?"Ø§Ù„Ù…Ù‚ØªØ·Ù":"Ø§Ù„Ù…Ø­ØªÙˆÙ‰"} Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...`}),((me=c[n])==null?void 0:me.ar)&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:c[n].ar})]})]})]})},Me=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:a("dashboard.posts.title")}),e.jsx(V,{onClick:D,children:a("dashboard.posts.addPost")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:a("dashboard.posts.searchPlaceholder"),value:p,onChange:n=>y(n.target.value),className:"w-full md:w-1/3 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("select",{value:i,onChange:n=>E(n.target.value),className:"w-full md:w-auto px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600",children:[e.jsx("option",{value:"all",children:a("dashboard.posts.all")}),e.jsx("option",{value:"published",children:a("dashboard.posts.published")}),e.jsx("option",{value:"draft",children:a("dashboard.posts.draft")})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("dashboard.posts.table.title")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("dashboard.posts.table.author")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("dashboard.posts.table.status")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("dashboard.posts.table.date")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("dashboard.posts.table.actions")})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:W.length>0?W.map(n=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50 dark:odd:bg-gray-800 dark:even:bg-black/10",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100",children:a(n.title)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:n.author}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx(Ce,{color:n.status==="published"?"green":"gray",children:a(`dashboard.posts.${n.status}`)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:n.date}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 rtl:space-x-reverse",children:[e.jsx("button",{onClick:()=>q(n),className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300",title:a("dashboard.posts.toggleStatus"),children:n.status==="published"?a("dashboard.posts.unpublish"):a("dashboard.posts.publish")}),e.jsx("button",{onClick:()=>O(n),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:a("dashboard.posts.edit")}),e.jsx("button",{onClick:()=>$(n),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:a("dashboard.posts.delete")})]})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10 text-gray-500 dark:text-gray-400",children:a("dashboard.posts.noPosts")})})})]})})]}),Te=()=>{var n,w,A;return e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:a(d?"dashboard.postForm.editTitle":"dashboard.postForm.addTitle")}),e.jsx("button",{onClick:je,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:a("dashboard.postsTabs.backToPosts")})]}),e.jsxs("form",{onSubmit:I=>fe(I,!1),className:"space-y-6",children:[he("title",((n=a("dashboard.postForm.titleEn"))==null?void 0:n.replace(" (English)",""))||"Title","input"),he("excerpt",((w=a("dashboard.postForm.excerptEn"))==null?void 0:w.replace(" (English)",""))||"Excerpt","textarea"),he("content",((A=a("dashboard.postForm.contentEn"))==null?void 0:A.replace(" (English)",""))||"Content","textarea"),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("dashboard.postForm.headerImage")}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"w-32 h-20 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0",children:M.imageUrl?e.jsx("img",{src:M.imageUrl,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",name:"imageUrl",value:M.imageUrl,onChange:Q,placeholder:"https://example.com/image.jpg",className:ce(c.imageUrl)+" flex-1"}),e.jsxs("button",{type:"button",onClick:()=>t(!0),className:"px-4 py-2 text-sm font-medium bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Browse"]})]}),c.imageUrl&&e.jsx("p",{className:"text-red-600 text-xs",children:c.imageUrl}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Enter URL or browse media library"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("dashboard.postForm.status")}),e.jsxs("select",{name:"status",value:M.status,onChange:Q,className:ce()+" max-w-xs",children:[e.jsx("option",{value:"draft",children:a("dashboard.posts.draft")}),e.jsx("option",{value:"published",children:a("dashboard.posts.published")})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(V,{variant:"secondary",onClick:je,type:"button",children:a("dashboard.postForm.cancel")}),e.jsx(V,{variant:"secondary",type:"button",disabled:F,onClick:I=>fe(I,!0),children:"Save as Draft"}),e.jsx(V,{type:"submit",disabled:F,className:"min-w-[120px]",children:F?e.jsx(ee,{className:"h-5 w-5 text-white"}):d?a("dashboard.postForm.save"):"Publish"})]})]})]})};return e.jsxs(te,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"flex space-x-8 rtl:space-x-reverse","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>{C("list"),b(null)},className:`py-3 px-1 border-b-2 font-medium text-sm transition-colors ${u==="list"?"border-smart-blue text-smart-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400"}`,children:["ðŸ“‹ ",a("dashboard.postsTabs.allPosts")]}),e.jsxs("button",{onClick:()=>{C("add"),b(null)},className:`py-3 px-1 border-b-2 font-medium text-sm transition-colors ${u==="add"&&!d?"border-smart-blue text-smart-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400"}`,children:["âž• ",a("dashboard.postsTabs.addNew")]}),d&&e.jsxs("span",{className:"py-3 px-1 border-b-2 border-smart-blue text-smart-blue font-medium text-sm",children:["âœï¸ ",a("dashboard.postsTabs.editing")," ",x==="ar"?d.title.ar.substring(0,20):d.title.en.substring(0,20),"..."]})]})}),u==="list"&&Me(),u==="add"&&Te(),R&&e.jsx(ye,{isOpen:!!R,onClose:()=>N(null),onConfirm:_,title:a("dashboard.confirmDelete.title"),message:a("dashboard.confirmDelete.messagePost")}),X&&e.jsx(Ge,{value:M.imageUrl,onChange:n=>T(w=>({...w,imageUrl:n})),onClose:()=>t(!1)})]})},Xe="smartstep.ly",Ye=({isOpen:r,onClose:f,user:l})=>{const{addUser:j,updateUser:m,users:a}=s.useContext(re),{t:x,language:h}=J(),{generateAndShowEmail:u}=oe(),C={email:"",password:"",role:"employee"},[d,b]=s.useState(C),[p,y]=s.useState(!1),[i,E]=s.useState({});s.useEffect(()=>{b(l?{email:l.email,password:"",role:l.role}:C),E({})},[l,r]);const R=()=>{const T={};let F=!0;return d.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)?a.some(o=>o.email.toLowerCase()===d.email.toLowerCase()&&o.id!==(l==null?void 0:l.id))?(T.email=x("dashboard.userForm.emailExists"),F=!1):d.email.endsWith(`@${Xe}`)&&(T.email=x("dashboard.userForm.emailDomainRestricted"),F=!1):(T.email=x("contact.validation.invalidEmail"),F=!1):(T.email=x("contact.validation.fieldRequired"),F=!1),!l&&!d.password?(T.password=x("contact.validation.fieldRequired"),F=!1):d.password&&d.password.length<8&&(T.password=x("resetPasswordPage.validation.passwordLength"),F=!1),E(T),F},N=T=>{const{name:F,value:o}=T.target;b(c=>({...c,[F]:o}))},U=async T=>{if(T.preventDefault(),!R())return;y(!0);const F={email:d.email,role:d.role,...d.password&&{password:d.password}};try{if(l)await m({...l,...F,password:d.password||l.password});else{const o=await j(F);if(o){const c=`${window.location.origin}${window.location.pathname}#/verify-email/${o}`;await u("new-user",{verificationLink:c},h)}}f()}catch(o){console.error("Failed to save user",o),alert("Could not save user. Please try again.")}finally{y(!1)}},M=T=>`w-full px-3 py-2 border rounded-lg focus:outline-none transition duration-150 ease-in-out bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${T?"border-red-400 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:ring-2 focus:ring-blue-200 focus:border-smart-blue"}`;return e.jsx(ue,{isOpen:r,onClose:f,title:x(l?"dashboard.userForm.editTitle":"dashboard.userForm.addTitle"),children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("dashboard.userForm.email")}),e.jsx("input",{id:"email",type:"email",name:"email",value:d.email,onChange:N,className:M(i.email),"aria-describedby":i.email?"email-error":void 0}),i.email&&e.jsx("p",{id:"email-error",className:"text-red-600 text-xs mt-1",role:"alert",children:i.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("dashboard.userForm.password")}),e.jsx("input",{id:"password",type:"password",name:"password",value:d.password,onChange:N,className:M(i.password),"aria-describedby":i.password?"password-error":void 0}),i.password&&e.jsx("p",{id:"password-error",className:"text-red-600 text-xs mt-1",role:"alert",children:i.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("dashboard.userForm.role")}),e.jsxs("select",{id:"role",name:"role",value:d.role,onChange:N,className:M(),children:[e.jsx("option",{value:"employee",children:x("dashboard.users.roleEmployee")}),e.jsx("option",{value:"admin",children:x("dashboard.users.roleAdmin")})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-4",children:[e.jsx(V,{variant:"secondary",onClick:f,type:"button",children:x("dashboard.userForm.cancel")}),e.jsx(V,{type:"submit",disabled:p,className:"flex items-center justify-center min-w-[120px]",children:p?e.jsx(ee,{className:"h-5 w-5 text-white"}):x("dashboard.userForm.save")})]})]})})},Je="arbh.ly@gmail.com",Qe=()=>{const{users:r,deleteUser:f}=s.useContext(re),{t:l}=J(),[j,m]=s.useState(!1),[a,x]=s.useState(null),[h,u]=s.useState(null),C=y=>{x(y),m(!0)},d=()=>{x(null),m(!0)},b=y=>{u(y)},p=async()=>{h&&(await f(h.id),u(null))};return e.jsxs(te,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:l("dashboard.users.title")}),e.jsx(V,{onClick:d,children:l("dashboard.users.addUser")})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.users.table.email")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.users.table.role")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.users.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map(y=>{const i=y.email===Je;return e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:y.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx(Ce,{color:y.role==="Super admin"?"purple":y.role==="admin"?"blue":"gray",children:y.role==="Super admin"?"Super Admin":l(y.role==="admin"?"dashboard.users.roleAdmin":"dashboard.users.roleEmployee")})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 rtl:space-x-reverse",children:[e.jsx("button",{onClick:()=>C(y),className:`text-blue-600 hover:text-blue-900 ${i?"opacity-50 cursor-not-allowed":""}`,disabled:i,children:l("dashboard.users.edit")}),e.jsx("button",{onClick:()=>b(y),className:`text-red-600 hover:text-red-900 ${i?"opacity-50 cursor-not-allowed":""}`,disabled:i,children:l("dashboard.users.delete")})]})]},y.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-10 text-gray-500",children:l("dashboard.users.noUsers")})})})]})}),j&&e.jsx(Ye,{isOpen:j,onClose:()=>m(!1),user:a}),h&&e.jsx(ye,{isOpen:!!h,onClose:()=>u(null),onConfirm:p,title:l("dashboard.confirmDelete.title"),message:l("dashboard.confirmDelete.messageUser")})]})},ae=8,se=128,Ze=({isOpen:r,onClose:f,onSave:l,imageSrc:j})=>{const m=s.useRef(null),a=s.useRef(null),x=s.useRef(null),[h,u]=s.useState({x:10,y:10,width:100,height:100}),[C,d]=s.useState(!1),[b,p]=s.useState(null),[y,i]=s.useState({x:0,y:0}),E=(t,g)=>{const S=m.current;if(!S)return{x:0,y:0};const v=S.getBoundingClientRect();return{x:t-v.left,y:g-v.top}},R=()=>{const t=m.current,g=t==null?void 0:t.getContext("2d"),S=x.current;if(!t||!g||!S)return;g.clearRect(0,0,t.width,t.height),g.drawImage(S,0,0,t.width,t.height),g.fillStyle="rgba(0, 0, 0, 0.5)",g.fillRect(0,0,t.width,t.height),g.clearRect(h.x,h.y,h.width,h.height),g.strokeStyle="#fff",g.lineWidth=2,g.strokeRect(h.x,h.y,h.width,h.height),g.fillStyle="#fff";const v=U(h);Object.values(v).forEach(k=>{g.fillRect(k.x-ae/2,k.y-ae/2,ae,ae)}),N()},N=()=>{const t=a.current,g=t==null?void 0:t.getContext("2d"),S=x.current,v=m.current;if(!t||!g||!S||!v)return;g.clearRect(0,0,t.width,t.height);const k=S.naturalWidth/v.width,W=S.naturalHeight/v.height;g.drawImage(S,h.x*k,h.y*W,h.width*k,h.height*W,0,0,t.width,t.height)};s.useEffect(()=>{const t=new Image;t.src=j,t.onload=()=>{x.current=t;const g=m.current;if(!g)return;const S=t.naturalWidth/t.naturalHeight,v=350;g.width=v,g.height=v/S;const k=Math.min(g.width,g.height)*.8;u({x:(g.width-k)/2,y:(g.height-k)/2,width:k,height:k})}},[j]),s.useEffect(()=>{x.current&&R()},[h,x.current]);const U=t=>({tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},bl:{x:t.x,y:t.y+t.height},br:{x:t.x+t.width,y:t.y+t.height}}),M=(t,g)=>{const S=U(g);for(const v in S){const k=S[v];if(Math.abs(t.x-k.x)<ae&&Math.abs(t.y-k.y)<ae)return v}return null},T=t=>{const g=M(t,h);g?p(g):t.x>h.x&&t.x<h.x+h.width&&t.y>h.y&&t.y<h.y+h.height&&d(!0),i(t)},F=t=>{const g=m.current;if(!g)return;const S=t.x-y.x,v=t.y-y.y;C?u(k=>({...k,x:Math.max(0,Math.min(k.x+S,g.width-k.width)),y:Math.max(0,Math.min(k.y+v,g.height-k.height))})):b&&u(k=>{let{x:W,y:O,width:D,height:$}=k,_=D,q=$;b.includes("r")&&(_=D+S),b.includes("l")&&(_=D-S,W+=S),b.includes("b")&&(q=$+v),b.includes("t")&&(q=$-v,O+=v);const G=Math.max(_,q);return b.includes("l")&&(W=k.x+k.width-G),b.includes("t")&&(O=k.y+k.height-G),D=G,$=G,W<0&&(W=0,D=k.width+k.x),O<0&&(O=0,$=k.height+k.y),W+D>g.width&&(D=g.width-W,$=D),O+$>g.height&&($=g.height-O,D=$),{x:W,y:O,width:D,height:$}}),i(t)},o=()=>{d(!1),p(null)},c=t=>T(E(t.clientX,t.clientY)),L=t=>F(E(t.clientX,t.clientY)),H=t=>T(E(t.touches[0].clientX,t.touches[0].clientY)),z=t=>F(E(t.touches[0].clientX,t.touches[0].clientY)),X=()=>{const t=m.current,g=x.current;if(!t||!g)return;const S=document.createElement("canvas");S.width=se,S.height=se;const v=S.getContext("2d");if(!v)return;const k=g.naturalWidth/t.width,W=g.naturalHeight/t.height;v.drawImage(g,h.x*k,h.y*W,h.width*k,h.height*W,0,0,se,se),l(S.toDataURL("image/png"))};return r?e.jsx(ue,{isOpen:r,onClose:f,title:"Crop Logo",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("canvas",{ref:m,className:"cursor-move border border-gray-300 dark:border-gray-600",onMouseDown:c,onMouseMove:L,onMouseUp:o,onMouseLeave:o,onTouchStart:H,onTouchMove:z,onTouchEnd:o})}),e.jsxs("div",{className:"flex-shrink-0 text-center space-y-2",children:[e.jsx("p",{className:"font-semibold text-sm",children:"Live Preview"}),e.jsx("canvas",{ref:a,width:se,height:se,className:"border-2 border-dashed border-gray-400 dark:border-gray-500 rounded-md"}),e.jsxs("div",{className:"flex gap-2 justify-center pt-4",children:[e.jsx(V,{variant:"secondary",onClick:f,children:"Cancel"}),e.jsx(V,{onClick:X,children:"Save"})]})]})]})}):null},et=()=>{const{siteInfo:r,updateSiteInfo:f}=s.useContext(re),{user:l}=oe(),{t:j}=J(),{translate:m}=pe(),[a,x]=s.useState(r),[h,u]=s.useState(!1),[C,d]=s.useState(!1),[b,p]=s.useState(!1),[y,i]=s.useState({isOpen:!1,imageSrc:""}),[E,R]=s.useState(()=>localStorage.getItem("autoTranslateEnabled")!=="false"),[N,U]=s.useState(""),[M,T]=s.useState(!1),[F,o]=s.useState("idle"),c=s.useRef(null),L=s.useRef(null),H=s.useRef(null),z=(l==null?void 0:l.role)==="Super admin";s.useEffect(()=>{x(r)},[r]),s.useEffect(()=>()=>{L.current&&clearTimeout(L.current)},[]);const X=()=>{const D=!E;R(D),localStorage.setItem("autoTranslateEnabled",String(D))},t=async()=>{if(N.trim()){o("saving");try{await be("/settings",{method:"PUT",body:JSON.stringify({settings:[{key:"gemini_api_key",value:N,group:"translation"}]})}),o("saved"),setTimeout(()=>o("idle"),3e3)}catch(D){console.error("Failed to save API key:",D),o("error")}}},g=async()=>{o("saving");try{await be("/settings",{method:"PUT",body:JSON.stringify({settings:[{key:"gemini_api_key",value:"",group:"translation"}]})}),U(""),o("idle")}catch(D){console.error("Failed to delete API key:",D),o("error")}},S=D=>{const{name:$,value:_}=D.target;if(H.current=$,$.includes(".")){const[q,G]=$.split(".");x(Q=>({...Q,[q]:{...Q[q],[G]:_}}))}else x(q=>({...q,[$]:_}));if(E&&(L.current&&clearTimeout(L.current),!!$.includes("."))){if(!_.trim()){p(!1);return}p(!0),L.current=window.setTimeout(async()=>{if(H.current!==$){p(!1);return}const[q,G]=$.split("."),Q=G==="ar"?"en":"ar",ne=await m(_,"a business address");ne&&H.current===$&&x(de=>({...de,address:{...de.address,[Q]:ne}})),p(!1)},800)}},v=D=>{D.preventDefault(),u(!0),setTimeout(()=>{f(a),u(!1),d(!0),setTimeout(()=>d(!1),3e3)},1e3)},k=D=>{if(D.target.files&&D.target.files[0]){const $=D.target.files[0],_=new FileReader;_.onload=q=>{var G;i({isOpen:!0,imageSrc:(G=q.target)==null?void 0:G.result})},_.readAsDataURL($),D.target.value=""}},W=D=>{x($=>({...$,logoUrl:D})),i({isOpen:!1,imageSrc:""})},O=()=>"w-full px-3 py-2 border rounded-lg focus:outline-none transition duration-150 ease-in-out bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 border-gray-300 focus:ring-2 focus:ring-blue-200 focus:border-smart-blue";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:j("dashboard.settings.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:j("dashboard.settings.subtitle")})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6 max-w-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Website Logo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 dark:bg-gray-700 border dark:border-gray-600 rounded-md flex items-center justify-center overflow-hidden",children:a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:"Logo Preview",className:"max-w-full max-h-full object-contain"}):e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 p-2 text-center",children:"No Logo"})}),e.jsx("input",{type:"file",accept:"image/png, image/jpeg, image/svg+xml",ref:c,onChange:k,hidden:!0}),e.jsx(V,{type:"button",variant:"secondary",onClick:()=>{var D;return(D=c.current)==null?void 0:D.click()},children:"Upload Logo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 relative",children:[e.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 rtl:translate-x-1/2 flex items-center justify-center h-5 w-5 bg-gray-100 dark:bg-gray-600 rounded-full border dark:border-gray-500 z-10",children:b?e.jsx(ie,{className:"h-4 w-4 text-smart-blue"}):e.jsx(le,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j("dashboard.settings.addressEn")}),e.jsx("input",{type:"text",name:"address.en",value:a.address.en,onChange:S,className:O()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j("dashboard.settings.addressAr")}),e.jsx("input",{type:"text",name:"address.ar",value:a.address.ar,onChange:S,dir:"rtl",className:O()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j("dashboard.settings.phone")}),e.jsx("input",{type:"text",name:"phone",value:a.phone,onChange:S,className:O()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j("dashboard.settings.email")}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:S,className:O()})]}),e.jsxs("div",{className:"pt-4 flex items-center gap-4",children:[e.jsx(V,{type:"submit",disabled:h,className:"flex items-center justify-center min-w-[150px]",children:h?e.jsx(ee,{className:"h-5 w-5 text-white"}):j("dashboard.settings.save")}),C&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400 transition-opacity duration-300",children:[e.jsx(Re,{className:"h-5 w-5"}),e.jsx("span",{children:j("dashboard.settings.success")})]})]})]})]}),e.jsxs(te,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Translation Settings"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Configure automatic translation behavior"})]}),e.jsxs("div",{className:"space-y-4 max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Auto-Translate Content"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Automatically translate content as you type"})]}),e.jsx("button",{type:"button",onClick:X,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-smart-blue focus:ring-offset-2 ${E?"bg-smart-blue":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${E?"translate-x-5":"translate-x-0"}`})})]}),z&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Gemini API Key (Super Admin Only)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:M?"text":"password",value:N,onChange:D=>U(D.target.value),placeholder:"Enter your Gemini API key",className:O()}),e.jsx("button",{type:"button",onClick:()=>T(!M),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:M?"ðŸ™ˆ":"ðŸ‘"})]})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(V,{type:"button",onClick:t,disabled:!N.trim()||F==="saving",className:"text-sm",children:F==="saving"?"Saving...":F==="saved"?"âœ“ Saved":"Save Key"}),e.jsx(V,{type:"button",variant:"secondary",onClick:g,className:"text-sm",children:"Delete Key"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Get your API key from ",e.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-smart-blue hover:underline",children:"Google AI Studio"})]})]})]})]}),y.isOpen&&e.jsx(Ze,{isOpen:y.isOpen,onClose:()=>i({isOpen:!1,imageSrc:""}),imageSrc:y.imageSrc,onSave:W})]})},tt=({isOpen:r,onClose:f,member:l})=>{const{addTeamMember:j,updateTeamMember:m}=s.useContext(re),{t:a}=J(),{translate:x}=pe(),h={name:{ar:"",en:""},role:{ar:"",en:""},imageUrl:""},[u,C]=s.useState(h),[d,b]=s.useState(!1),[p,y]=s.useState({}),[i,E]=s.useState({name:!1,role:!1}),R=s.useRef(null),N=s.useRef(null);s.useEffect(()=>{C(l?{name:l.name,role:l.role,imageUrl:l.imageUrl}:h),y({}),E({name:!1,role:!1})},[l,r]),s.useEffect(()=>()=>{R.current&&clearTimeout(R.current)},[]);const U=()=>{const c={name:{},role:{}};let L=!0;return u.name.en.trim()||(c.name.en=a("contact.validation.fieldRequired"),L=!1),u.name.ar.trim()||(c.name.ar=a("contact.validation.fieldRequired"),L=!1),u.role.en.trim()||(c.role.en=a("contact.validation.fieldRequired"),L=!1),u.role.ar.trim()||(c.role.ar=a("contact.validation.fieldRequired"),L=!1),u.imageUrl.trim()||(c.imageUrl=a("contact.validation.fieldRequired"),L=!1),y(c),L},M=c=>{const{name:L,value:H}=c.target;if(N.current=L,L.includes(".")){const[t,g]=L.split(".");C(S=>({...S,[t]:{...S[t],[g]:H}}))}else C(t=>({...t,[L]:H}));if(R.current&&clearTimeout(R.current),!L.includes("."))return;const[z,X]=L.split(".");if(!H.trim()){E(t=>({...t,[z]:!1}));return}E(t=>({...t,[z]:!0})),R.current=window.setTimeout(async()=>{if(N.current!==L){E(v=>({...v,[z]:!1}));return}const t=X==="ar"?"en":"ar",g=`a team member's ${z}`,S=await x(H,g);S&&N.current===L&&C(v=>({...v,[z]:{...v[z],[t]:S}})),E(v=>({...v,[z]:!1}))},800)},T=c=>{c.preventDefault(),U()&&(b(!0),setTimeout(()=>{l?m({...l,...u}):j(u),b(!1),f()},1e3))},F=c=>`w-full px-3 py-2 border rounded-lg focus:outline-none transition duration-150 ease-in-out bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${c?"border-red-400 focus:ring-2 focus:ring-red-200":"border-gray-300 focus:ring-2 focus:ring-blue-200 focus:border-smart-blue"}`,o=c=>{var L,H,z,X,t,g;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 relative",children:[e.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 rtl:translate-x-1/2 flex items-center justify-center h-5 w-5 bg-gray-100 dark:bg-gray-600 rounded-full border dark:border-gray-500 z-10",children:i[c]?e.jsx(ie,{}):e.jsx(le,{})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${c}-en`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a(`dashboard.teamForm.${c}En`)}),e.jsx("input",{type:"text",id:`${c}-en`,name:`${c}.en`,value:u[c].en,onChange:M,className:F((L=p[c])==null?void 0:L.en),"aria-describedby":(H=p[c])!=null&&H.en?`${c}-en-error`:void 0}),((z=p[c])==null?void 0:z.en)&&e.jsx("p",{id:`${c}-en-error`,className:"text-red-600 text-xs mt-1",role:"alert",children:p[c].en})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${c}-ar`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a(`dashboard.teamForm.${c}Ar`)}),e.jsx("input",{type:"text",id:`${c}-ar`,name:`${c}.ar`,value:u[c].ar,onChange:M,dir:"rtl",className:F((X=p[c])==null?void 0:X.ar),"aria-describedby":(t=p[c])!=null&&t.ar?`${c}-ar-error`:void 0}),((g=p[c])==null?void 0:g.ar)&&e.jsx("p",{id:`${c}-ar-error`,className:"text-red-600 text-xs mt-1",role:"alert",children:p[c].ar})]})]})};return e.jsx(ue,{isOpen:r,onClose:f,title:a(l?"dashboard.teamForm.editTitle":"dashboard.teamForm.addTitle"),children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[o("name"),o("role"),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("dashboard.teamForm.imageUrl")}),e.jsx("input",{id:"imageUrl",type:"text",name:"imageUrl",value:u.imageUrl,onChange:M,className:F(p.imageUrl),"aria-describedby":p.imageUrl?"imageUrl-error":void 0}),p.imageUrl&&e.jsx("p",{id:"imageUrl-error",className:"text-red-600 text-xs mt-1",role:"alert",children:p.imageUrl})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-4",children:[e.jsx(V,{variant:"secondary",onClick:f,type:"button",children:a("dashboard.teamForm.cancel")}),e.jsx(V,{type:"submit",disabled:d,className:"flex items-center justify-center min-w-[120px]",children:d?e.jsx(ee,{}):a(l?"dashboard.teamForm.save":"dashboard.teamForm.addTitle")})]})]})})},at=()=>{const{teamMembers:r,deleteTeamMember:f}=s.useContext(re),{t:l}=J(),[j,m]=s.useState(!1),[a,x]=s.useState(null),[h,u]=s.useState(null),C=y=>{x(y),m(!0)},d=()=>{x(null),m(!0)},b=y=>{u(y)},p=()=>{h&&(f(h.id),u(null))};return e.jsxs(te,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:l("dashboard.team.title")}),e.jsx(V,{onClick:d,children:l("dashboard.team.addMember")})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.team.table.photo")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.team.table.name")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.team.table.role")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("dashboard.team.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map(y=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:y.imageUrl,alt:l(y.name)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:l(y.name)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l(y.role)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 rtl:space-x-reverse",children:[e.jsx("button",{onClick:()=>C(y),className:"text-blue-600 hover:text-blue-900",children:l("dashboard.team.edit")}),e.jsx("button",{onClick:()=>b(y),className:"text-red-600 hover:text-red-900",children:l("dashboard.team.delete")})]})]},y.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-10 text-gray-500",children:l("dashboard.team.noMembers")})})})]})}),j&&e.jsx(tt,{isOpen:j,onClose:()=>m(!1),member:a}),h&&e.jsx(ye,{isOpen:!!h,onClose:()=>u(null),onConfirm:p,title:l("dashboard.confirmDelete.title"),message:l("dashboard.confirmDelete.messageTeamMember")})]})},st=[{value:"all",labelKey:"dashboard.messages.filter.all"},{value:"new",labelKey:"dashboard.messages.filter.new"},{value:"read",labelKey:"dashboard.messages.filter.read"},{value:"archived",labelKey:"dashboard.messages.filter.archived"}],rt=()=>{const{t:r}=J(),[f,l]=s.useState([]),[j,m]=s.useState(null),[a,x]=s.useState("all"),[h,u]=s.useState(!1),[C,d]=s.useState(null),[b,p]=s.useState(""),[y,i]=s.useState(!1),[E,R]=s.useState(!1),N=s.useMemo(()=>f.find(o=>o.id===j)||null,[f,j]),U=async()=>{u(!0),d(null);try{const o=await Fe(a==="all"?void 0:a),c=Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o)?o:(o==null?void 0:o.data)??[];l(c),!j&&c.length&&m(c[0].id)}catch(o){d((o==null?void 0:o.message)||r("dashboard.messages.errors.load"))}finally{u(!1)}};s.useEffect(()=>{U()},[a]);const M=async(o,c)=>{if(m(o),c==="new"){R(!0);try{await ve(o,"read"),l(L=>L.map(H=>H.id===o?{...H,status:"read"}:H))}catch{}finally{R(!1)}}},T=async()=>{if(!(!N||!b.trim())){i(!0),d(null);try{const o=await Ie(N.id,b.trim());l(c=>c.map(L=>L.id===N.id?{...L,...o}:L)),p("")}catch(o){d((o==null?void 0:o.message)||r("dashboard.messages.errors.reply"))}finally{i(!1)}}},F=async()=>{if(N){R(!0);try{await ve(N.id,N.status==="archived"?"read":"archived"),l(o=>o.map(c=>c.id===N.id?{...c,status:c.status==="archived"?"read":"archived"}:c))}catch(o){d((o==null?void 0:o.message)||r("dashboard.messages.errors.status"))}finally{R(!1)}}};return e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(te,{className:"lg:col-span-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Se,{className:"text-smart-blue"}),r("dashboard.messages.title")]}),e.jsx("select",{className:"border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600",value:a,onChange:o=>x(o.target.value),children:st.map(o=>e.jsx("option",{value:o.value,children:r(o.labelKey)},o.value))})]}),h?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(ee,{className:"h-6 w-6"})}):C?e.jsx("div",{className:"text-red-600 text-sm",children:C}):e.jsxs("div",{className:"space-y-2 max-h-[70vh] overflow-auto pr-1",children:[f.length===0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("dashboard.messages.empty")}),f.map(o=>e.jsxs("button",{onClick:()=>M(o.id,o.status),className:`w-full text-left p-3 rounded-lg border transition ${j===o.id?"border-smart-blue bg-blue-50 dark:bg-gray-800":"border-gray-200 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-800 dark:text-gray-100",children:o.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o.status==="new"?"bg-green-100 text-green-700":o.status==="archived"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700"}`,children:r(`dashboard.messages.status.${o.status}`)})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:o.email}),o.subject&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:o.subject}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(o.created_at).toLocaleString()})]},o.id))]})]}),e.jsx(te,{className:"lg:col-span-2 p-6",children:N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:N.subject||r("dashboard.messages.noSubject")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[r("dashboard.messages.from"),": ",N.name," (",N.email,")"]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(N.created_at).toLocaleString()})]}),e.jsx(V,{onClick:F,variant:"secondary",disabled:E,children:E?r("dashboard.messages.updating"):N.status==="archived"?r("dashboard.messages.unarchive"):r("dashboard.messages.archive")})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-800",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-100",children:N.message})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:r("dashboard.messages.replyLabel")}),N.reply_message&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-300",children:[r("dashboard.messages.lastReply")," ",N.replied_at?new Date(N.replied_at).toLocaleString():""]}),e.jsx("textarea",{value:b,onChange:o=>p(o.target.value),rows:4,className:"w-full border rounded-lg p-3 bg-white dark:bg-gray-800 dark:border-gray-700",placeholder:r("dashboard.messages.replyPlaceholder")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(V,{onClick:T,disabled:y||!b.trim(),className:"flex items-center gap-2",children:[y&&e.jsx(ee,{className:"h-4 w-4"}),r("dashboard.messages.sendReply")]}),N.reply_message&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("dashboard.messages.alreadyReplied")})]})]}),C&&e.jsx("div",{className:"text-red-600 text-sm",children:C})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:r("dashboard.messages.noSelection")})})]})},nt=[{value:"all",labelKey:"dashboard.subscriptions.filter.all"},{value:"active",labelKey:"dashboard.subscriptions.filter.active"},{value:"unsubscribed",labelKey:"dashboard.subscriptions.filter.unsubscribed"}],lt=()=>{const{t:r}=J(),[f,l]=s.useState([]),[j,m]=s.useState("all"),[a,x]=s.useState(!1),[h,u]=s.useState(null),[C,d]=s.useState(null),b=async()=>{x(!0),u(null);try{const i=await ze(j==="all"?void 0:j),E=Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i)?i:(i==null?void 0:i.data)??[];l(E)}catch(i){console.error("Failed to load subscriptions:",i),u((i==null?void 0:i.message)||r("dashboard.subscriptions.errors.load"))}finally{x(!1)}};s.useEffect(()=>{b()},[j]);const p=async i=>{const E=i.status==="active"?"unsubscribed":"active";d(i.id);try{await Ae(i.id,E),l(R=>R.map(N=>N.id===i.id?{...N,status:E}:N))}catch(R){u((R==null?void 0:R.message)||r("dashboard.subscriptions.errors.update"))}finally{d(null)}},y=async i=>{if(confirm(r("dashboard.subscriptions.confirmDelete"))){d(i);try{await He(i),l(E=>E.filter(R=>R.id!==i))}catch(E){u((E==null?void 0:E.message)||r("dashboard.subscriptions.errors.delete"))}finally{d(null)}}};return e.jsxs(te,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Se,{className:"text-smart-blue"}),r("dashboard.subscriptions.title")||"Email Subscriptions"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{className:"border rounded px-3 py-2 text-sm dark:bg-gray-700 dark:border-gray-600",value:j,onChange:i=>m(i.target.value),children:nt.map(i=>e.jsx("option",{value:i.value,children:r(i.labelKey)||i.value},i.value))}),e.jsx(V,{onClick:b,variant:"secondary",disabled:a,children:a?e.jsx(ee,{className:"h-4 w-4"}):r("dashboard.refresh")||"Refresh"})]})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm",children:h}),a?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(ee,{className:"h-8 w-8"})}):f.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:r("dashboard.subscriptions.empty")||"No subscriptions found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.email")||"Email"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.name")||"Name"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.source")||"Source"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.status")||"Status"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.date")||"Date"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-gray-700 dark:text-gray-200",children:r("dashboard.subscriptions.actions")||"Actions"})]})}),e.jsx("tbody",{children:f.map(i=>e.jsxs("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-800 dark:text-gray-100",children:i.email}),e.jsx("td",{className:"py-3 px-4 text-gray-600 dark:text-gray-300",children:i.name||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600 dark:text-gray-300",children:e.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:i.source||"website"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${i.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-400"}`,children:i.status})}),e.jsx("td",{className:"py-3 px-4 text-gray-600 dark:text-gray-300 text-sm",children:new Date(i.subscribed_at).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"secondary",onClick:()=>p(i),disabled:C===i.id,className:"text-xs py-1 px-2",children:C===i.id?e.jsx(ee,{className:"h-3 w-3"}):i.status==="active"?r("dashboard.subscriptions.unsubscribe")||"Unsubscribe":r("dashboard.subscriptions.resubscribe")||"Resubscribe"}),e.jsx("button",{onClick:()=>y(i.id),disabled:C===i.id,className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition",title:r("dashboard.subscriptions.delete")||"Delete",children:e.jsx(Ue,{className:"h-4 w-4"})})]})})]},i.id))})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:[r("dashboard.subscriptions.total")||"Total",": ",f.length," ",r("dashboard.subscriptions.subscribers")||"subscribers"]})]})},ct=()=>{const{user:r}=oe(),{t:f}=J(),[l,j]=s.useState("posts"),[m,a]=s.useState(!1),x=()=>{switch(l){case"posts":return e.jsx(Ne,{});case"messages":return e.jsx(rt,{});case"subscriptions":return e.jsx(lt,{});case"users":return e.jsx(Qe,{});case"team":return e.jsx(at,{});case"settings":return e.jsx(et,{});default:return e.jsx(Ne,{})}},h=()=>{const u={posts:f("dashboard.tabs.posts"),messages:f("dashboard.tabs.messages"),subscriptions:f("dashboard.tabs.subscriptions")||"Subscriptions",users:f("dashboard.tabs.users"),team:f("dashboard.tabs.team"),settings:f("dashboard.tabs.settings")};return u[l]||u.posts};return e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(qe,{activeSection:l,onSectionChange:j,isOpen:m,onToggle:()=>a(!m)}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:h()}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[f("dashboardPage.welcome")," ",r==null?void 0:r.email]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:x()})]})})]})};export{ct as default};
